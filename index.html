<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Daily Companion</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter and Noto Naskh Arabic for elegant typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Noto+Naskh+Arabic:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        /* Custom styles for the application */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-image 1s ease-in-out;
        }

        /* Style for the Arabic text, using a dedicated Arabic font */
        .arabic-quote {
            font-family: 'Noto Naskh Arabic', serif;
            direction: rtl; /* Right-to-left text direction for Arabic */
        }
        
        /* Fade-in animation for loaded content */
        .fade-in {
            animation: fadeInAnimation 1s ease-in-out forwards;
            opacity: 0;
        }

        @keyframes fadeInAnimation {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Styling for the glassmorphism effect on containers */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-900 bg-cover bg-center bg-no-repeat text-white relative flex flex-col items-center justify-center min-h-screen p-4 md:p-6">

    <!-- Background Image Overlay -->
    <div class="absolute inset-0 bg-black opacity-50 z-0"></div>

    <!-- Top Navigation Icons -->
    <nav class="absolute top-4 right-4 z-20 flex flex-wrap gap-2 sm:gap-4 justify-end">
        <a href="https://nabilpervezconsulting.com/" target="_blank" rel="noopener noreferrer" 
           class="glass-card p-2 sm:p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 group">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 012 2v6a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 012-2V6"></path>
            </svg>
        </a>
        <a href="https://barakaboostapp.netlify.app/" target="_blank" rel="noopener noreferrer"
           class="glass-card p-2 sm:p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 group">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-green-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
        </a>
        <a href="https://candid-syrniki-80afa6.netlify.app" target="_blank" rel="noopener noreferrer"
           class="glass-card p-2 sm:p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 group">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-teal-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
        </a>
        <a href="https://muhasabah.netlify.app/" target="_blank" rel="noopener noreferrer"
           class="glass-card p-2 sm:p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 group">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-purple-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C20.168 18.477 18.582 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
        </a>
        <a href="https://ayahecho.netlify.app/" target="_blank" rel="noopener noreferrer"
           class="glass-card p-2 sm:p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 group">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-yellow-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
            </svg>
        </a>
        <a href="https://learnthenamesofallah.netlify.app/" target="_blank" rel="noopener noreferrer"
           class="glass-card p-2 sm:p-3 rounded-full hover:bg-white hover:bg-opacity-20 transition-all duration-300 group">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:text-amber-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
            </svg>
        </a>
    </nav>
    <!-- Location Input Modal -->
    <div id="locationModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-white text-gray-800 rounded-lg p-8 max-w-sm text-center shadow-2xl">
            <h2 class="text-2xl font-bold mb-4">Set Your Location</h2>
            <p class="mb-6">To provide accurate prayer times, please enter your coordinates. Your location data is saved only in your browser.</p>
            <div class="mb-4">
                <label for="latitudeInput" class="block text-left text-sm font-medium text-gray-700">Latitude</label>
                <input type="text" id="latitudeInput" value="32.7767" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
            <div class="mb-6">
                <label for="longitudeInput" class="block text-left text-sm font-medium text-gray-700">Longitude</label>
                <input type="text" id="longitudeInput" value="-96.7970" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
            <button id="saveLocationBtn" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 w-full">Save Location</button>
            <p id="locationError" class="text-red-500 text-sm mt-4"></p>
        </div>
    </div>

    <!-- Main Content Container -->
    <main id="mainContent" class="relative z-10 flex flex-col items-center justify-center text-center w-full flex-grow opacity-0 transition-opacity duration-1000 pt-20 sm:pt-16">
        <!-- Quranic Quote Section -->
        <div class="max-w-3xl mb-8 px-4">
            <p id="quranArabic" class="arabic-quote text-2xl sm:text-3xl md:text-4xl lg:text-5xl leading-relaxed mb-4 px-2"></p>
            <p id="quranEnglish" class="text-base sm:text-lg md:text-xl italic px-2"></p>
            <p id="quranReference" class="text-sm text-gray-300 mt-4 px-2"></p>
        </div>

        <!-- Pomodoro Timer Section -->
        <div id="pomodoroApp" class="glass-card rounded-xl p-4 sm:p-5 mb-8 max-w-sm w-full mx-4">
            <!-- Timer Mode Selection -->
            <div class="flex justify-center gap-1 mb-4 sm:mb-5">
                <button id="pomodoroBtn" class="mode-btn bg-red-500 bg-opacity-80 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300 hover:bg-opacity-100">
                    Pomodoro
                </button>
                <button id="shortBreakBtn" class="mode-btn bg-blue-500 bg-opacity-60 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300 hover:bg-opacity-80">
                    Short Break
                </button>
                <button id="longBreakBtn" class="mode-btn bg-green-500 bg-opacity-60 text-white px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300 hover:bg-opacity-80">
                    Long Break
                </button>
            </div>

            <!-- Timer Display -->
            <div class="text-center mb-4 sm:mb-5">
                <div id="timerDisplay" class="text-4xl sm:text-5xl font-bold text-white mb-2">15:00</div>
                <div id="sessionCount" class="text-sm text-gray-300">Session 1</div>
            </div>

            <!-- Timer Controls -->
            <div class="flex justify-center gap-2 sm:gap-3 mb-4 sm:mb-5">
                <button id="startBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 sm:px-5 py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300">
                    Start
                </button>
                <button id="pauseBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 sm:px-5 py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300 hidden">
                    Pause
                </button>
                <button id="resetBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-medium transition-all duration-300">
                    Reset
                </button>
            </div>

            <!-- To-Do List -->
            <div class="border-t border-white border-opacity-20 pt-4">
                <h3 class="text-sm sm:text-base font-medium text-white mb-2">Focus Tasks</h3>
                <div class="flex mb-2">
                    <input type="text" id="taskInput" placeholder="Add a task..." 
                           class="flex-1 px-2 py-2 text-xs sm:text-sm bg-white bg-opacity-20 text-white placeholder-gray-300 rounded-l-lg border-none outline-none">
                    <button id="addTaskBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-2 sm:px-3 py-2 text-xs sm:text-sm rounded-r-lg transition-colors duration-300">
                        Add
                    </button>
                </div>
                <ul id="taskList" class="space-y-1 max-h-24 sm:max-h-28 overflow-y-auto">
                    <!-- Tasks will be rendered here -->
                </ul>
            </div>
        </div>
    </main>

    <!-- Bottom Information Bar -->
    <footer id="footerContent" class="relative z-10 w-full max-w-7xl mt-auto opacity-0 transition-opacity duration-1000">
        <!-- Date and Time Display -->
        <div class="text-center mb-4">
            <p id="gregorianTime" class="text-4xl md:text-5xl font-bold"></p>
            <p id="gregorianDate" class="text-md md:text-lg"></p>
            <p id="islamicDate" class="text-md md:text-lg text-gray-300"></p>
        </div>

        <!-- Prayer Times Bar -->
        <div id="prayerTimes" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 p-4 rounded-lg glass-card">
            <!-- Prayer time items will be injected here by JavaScript -->
        </div>
    </footer>

    <!-- Audio Elements -->
    <audio id="brownNoise" loop>
        <source src="https://www.soundjay.com/misc/sounds/brown-noise.mp3" type="audio/mpeg">
        <!-- Fallback brown noise URL -->
        <source src="https://archive.org/download/BrownNoise/brown-noise-10min.mp3" type="audio/mpeg">
    </audio>
    <audio id="chimeSound">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" type="audio/mpeg">
        <!-- Fallback chime URL -->
        <source src="https://archive.org/download/SampleAudio0424/SampleAudio_0.4s_1MB_mp3.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- DOM Element References ---
        const body = document.body;
        const locationModal = document.getElementById('locationModal');
        const saveLocationBtn = document.getElementById('saveLocationBtn');
        const latitudeInput = document.getElementById('latitudeInput');
        const longitudeInput = document.getElementById('longitudeInput');
        const locationError = document.getElementById('locationError');
        const mainContent = document.getElementById('mainContent');
        const footerContent = document.getElementById('footerContent');
        const quranArabic = document.getElementById('quranArabic');
        const quranEnglish = document.getElementById('quranEnglish');
        const quranReference = document.getElementById('quranReference');
        const gregorianTime = document.getElementById('gregorianTime');
        const gregorianDate = document.getElementById('gregorianDate');
        const islamicDate = document.getElementById('islamicDate');
        const prayerTimesContainer = document.getElementById('prayerTimes');

        // Pomodoro Timer Elements
        const pomodoroBtn = document.getElementById('pomodoroBtn');
        const shortBreakBtn = document.getElementById('shortBreakBtn');
        const longBreakBtn = document.getElementById('longBreakBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const sessionCount = document.getElementById('sessionCount');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');
        const brownNoise = document.getElementById('brownNoise');
        const chimeSound = document.getElementById('chimeSound');

        // --- Data Sources ---
        const quranicVerses = 
        [
        { arabic: "فَإِنَّ مَعَ الْعُسْرِ يُسْرًا", english: "For indeed, with hardship [will be] ease.", reference: "Quran 94:5" },
        { arabic: "وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ", english: "And whoever relies upon Allah - then He is sufficient for him.", reference: "Quran 65:3" },
        { arabic: "أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ", english: "Unquestionably, by the remembrance of Allah hearts are assured.", reference: "Quran 13:28" },
        { arabic: "وَاسْتَعِينُوا بِالصَّبْرِ وَالصَّلَاةِ", english: "And seek help through patience and prayer.", reference: "Quran 2:45" },
        { arabic: "لَا يُكَلِّفُ اللَّهُ نَفْسًا إِلَّا وُسْعَهَا", english: "Allah does not burden a soul beyond that it can bear.", reference: "Quran 2:286" },
        { arabic: "إِنَّ اللَّهَ مَعَ الصَّابِرِينَ", english: "Indeed, Allah is with the patient.", reference: "Quran 2:153" },
        { arabic: "فَاذْكُرُونِي أَذْكُرْكُمْ", english: "So remember Me; I will remember you.", reference: "Quran 2:152" },
        { arabic: "وَمَا أَرْسَلْنَاكَ إِلَّا رَحْمَةً لِّلْعَالَمِينَ", english: "And We have not sent you, [O Muhammad], except as a mercy to the worlds.", reference: "Quran 21:107" },
        { arabic: "يَا أَيُّهَا الَّذِينَ آمَنُوا اتَّقُوا اللَّهَ وَقُولُوا قَوْلًا سَدِيدًا", english: "O you who have believed, fear Allah and speak words of appropriate uprightness.", reference: "Quran 33:70" },
        { arabic: "إِنَّ الْإِنسَانَ لَفِي خُسْرٍ إِلَّا الَّذِينَ آمَنُوا وَعَمِلُوا الصَّالِحَاتِ", english: "Indeed, mankind is in loss, except for those who have believed and done righteous deeds.", reference: "Quran 103:2-3" },
        { arabic: "فَاصْبِرْ إِنَّ وَعْدَ اللَّهِ حَقٌّ", english: "So be patient; indeed, the promise of Allah is truth.", reference: "Quran 30:60" },
        { arabic: "وَلَا تَيْأَسُوا مِن رَّوْحِ اللَّهِ", english: "And never give up hope of Allah's soothing comfort.", reference: "Quran 12:87" },
        { arabic: "قُلْ هُوَ اللَّهُ أَحَدٌ", english: "Say, 'He is Allah, [who is] One.'", reference: "Quran 112:1" },
        { arabic: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ", english: "Our Lord, give us in this world [that which is] good and in the Hereafter [that which is] good and protect us from the punishment of the Fire.", reference: "Quran 2:201" },
        { arabic: "هُوَ اللَّهُ الْخَالِقُ الْبَارِئُ الْمُصَوِّرُ ۖ لَهُ الْأَسْمَاءُ الْحُسْنَىٰ", english: "He is Allah, the Creator, the Inventor, the Fashioner; to Him belong the best names.", reference: "Quran 59:24" },
        { arabic: "إِنَّ اللَّهَ يُحِبُّ الْمُتَوَكِّلِينَ", english: "Indeed, Allah loves those who rely [upon Him].", reference: "Quran 3:159" },
        { arabic: "وَمَا كَانَ اللَّهُ مُعَذِّبَهُمْ وَهُمْ يَسْتَغْفِرُونَ", english: "But Allah would not punish them while they sought forgiveness.", reference: "Quran 8:33" },
        { arabic: "وَلَقَدْ يَسَّرْنَا الْقُرْآنَ لِلذِّكْرِ فَهَلْ مِن مُّدَّكِرٍ", english: "And We have certainly made the Qur'an easy for remembrance, so is there any who will remember?", reference: "Quran 54:17" },
        { arabic: "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا", english: "And whoever fears Allah - He will make for him a way out.", reference: "Quran 65:2" },
        { arabic: "لَا إِكْرَاهَ فِي الدِّينِ", english: "There shall be no compulsion in [acceptance of] the religion.", reference: "Quran 2:256" },
        { arabic: "فَاعْلَمْ أَنَّهُ لَا إِلَٰهَ إِلَّا اللَّهُ", english: "So know, [O Muhammad], that there is no deity except Allah.", reference: "Quran 47:19" },
        { arabic: "اللَّهُ نُورُ السَّمَاوَاتِ وَالْأَرْضِ", english: "Allah is the Light of the heavens and the earth.", reference: "Quran 24:35" },
        { arabic: "وَقُل رَّبِّ زِدْنِي عِلْمًا", english: "And say, 'My Lord, increase me in knowledge.'", reference: "Quran 20:114" },
        { arabic: "وَمَا النَّصْرُ إِلَّا مِنْ عِندِ اللَّهِ", english: "And victory is not but from Allah.", reference: "Quran 3:126" },
        { arabic: "وَأَن لَّيْسَ لِلْإِنسَانِ إِلَّا مَا سَعَىٰ", english: "And that there is not for man except that [good] for which he strives.", reference: "Quran 53:39" },
        { arabic: "إِنَّ اللَّهَ غَفُورٌ رَّحِيمٌ", english: "Indeed, Allah is Forgiving and Merciful.", reference: "Quran 2:173" },
        { arabic: "ادْعُونِي أَسْتَجِبْ لَكُمْ", english: "Call upon Me; I will respond to you.", reference: "Quran 40:60" },
        { arabic: "إِنَّ مَعَ الْعُسْرِ يُسْرًا", english: "Indeed, with hardship [will be] ease.", reference: "Quran 94:6" },
        { arabic: "وَمَا تَوْفِيقِي إِلَّا بِاللَّهِ", english: "And my success is not but through Allah.", reference: "Quran 11:88" },
        { arabic: "إِنَّ اللَّهَ لَا يُخْلِفُ الْمِيعَادَ", english: "Indeed, Allah does not fail in His promise.", reference: "Quran 3:9" },
        { arabic: "وَاصْبِرْ وَمَا صَبْرُكَ إِلَّا بِاللَّهِ", english: "And be patient, [O Muhammad], and your patience is not but through Allah.", reference: "Quran 16:127" },
        { arabic: "إِنَّ اللَّهَ بِالنَّاسِ لَرَءُوفٌ رَّحِيمٌ", english: "Indeed, Allah is, to the people, Kind and Merciful.", reference: "Quran 22:65" },
        { arabic: "قُلْ إِنَّ صَلَاتِي وَنُسُكِي وَمَحْيَايَ وَمَمَاتِي لِلَّهِ رَبِّ الْعَالَمِينَ", english: "Say, 'Indeed, my prayer, my rites of sacrifice, my living and my dying are for Allah, Lord of the worlds.'", reference: "Quran 6:162" },
        { arabic: "هُوَ الَّذِي جَعَلَ الشَّمْسَ ضِيَاءً وَالْقَمَرَ نُورًا", english: "He it is who made the sun a shining light and the moon a [reflected] light.", reference: "Quran 10:5" },
        { arabic: "وَمِنْ آيَاتِهِ أَنْ خَلَقَ لَكُم مِّنْ أَنفُسِكُمْ أَزْوَاجًا لِّتَسْكُنُوا إِلَيْهَا", english: "And of His signs is that He created for you from yourselves mates that you may find tranquility in them.", reference: "Quran 30:21" },
        { arabic: "إِنَّ اللَّهَ سَمِيعٌ عَلِيمٌ", english: "Indeed, Allah is Hearing and Knowing.", reference: "Quran 2:227" },
        { arabic: "فَاسْتَقِيمُوا إِلَيْهِ وَاسْتَغْفِرُوهُ", english: "So remain on a direct course toward Him and seek His forgiveness.", reference: "Quran 41:6" },
        { arabic: "لَقَدْ كَانَ لَكُمْ فِي رَسُولِ اللَّهِ أُسْوَةٌ حَسَنَةٌ", english: "There has certainly been for you in the Messenger of Allah an excellent pattern.", reference: "Quran 33:21" },
        { arabic: "وَلَا تَمْشِ فِي الْأَرْضِ مَرَحًا", english: "And do not walk upon the earth exultantly.", reference: "Quran 17:37" },
        { arabic: "وَتَعَاوَنُوا عَلَى الْبِرِّ وَالتَّقْوَىٰ", english: "And cooperate in righteousness and piety.", reference: "Quran 5:2" },
        { arabic: "وَهُوَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ", english: "And He is over all things competent.", reference: "Quran 5:120" },
        { arabic: "وَمَن يُؤْتَ الْحِكْمَةَ فَقَدْ أُوتِيَ خَيْرًا كَثِيرًا", english: "And whoever is granted wisdom has certainly been granted much good.", reference: "Quran 2:269" },
        { arabic: "إِنَّ اللَّهَ لَا يُضِيعُ أَجْرَ الْمُحْسِنِينَ", english: "Indeed, Allah does not allow to be lost the reward of those who do good.", reference: "Quran 9:120" },
        { arabic: "يُرِيدُ اللَّهُ بِكُمُ الْيُسْرَ وَلَا يُرِيدُ بِكُمُ الْعُسْرَ", english: "Allah intends for you ease and does not intend for you hardship.", reference: "Quran 2:185" },
        { arabic: "وَاذْكُر رَّبَّكَ إِذَا نَسِيتَ", english: "And remember your Lord when you forget.", reference: "Quran 18:24" },
        { arabic: "وَلَا تَيْأَسُوا مِن رَّوْحِ اللَّهِ", english: "And never give up hope of Allah's soothing comfort.", reference: "Quran 12:87" }
        ];

        const backgroundImages = [
            'https://images.unsplash.com/photo-1512970648279-ff3398568f77?q=80&w=3552&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
            'https://images.unsplash.com/photo-1512632578888-169bbbc64f33?q=80&w=1740&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
            'https://plus.unsplash.com/premium_photo-1697730012360-d49e7ca1a776?q=80&w=1784&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
            'https://images.unsplash.com/flagged/photo-1558113118-e42e558b352a?q=80&w=1548&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
            'https://images.unsplash.com/photo-1508724547755-22fa72fcbe24?q=80&w=1740&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'
        ];

        // --- Pomodoro Timer Logic ---
        let currentMode = 'pomodoro';
        let timeLeft = 15 * 60; // 15 minutes in seconds
        let timerInterval = null;
        let isRunning = false;
        let pomodoroCount = 1;
        let tasks = JSON.parse(localStorage.getItem('pomodoroTasks')) || [];

        const timerDurations = {
            pomodoro: 15 * 60,
            shortBreak: 5 * 60,
            longBreak: 15 * 60
        };

        const updateTimerDisplay = () => {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        };

        const startTimer = () => {
            if (!isRunning) {
                isRunning = true;
                startBtn.classList.add('hidden');
                pauseBtn.classList.remove('hidden');
                
                // Play brown noise only during pomodoro sessions
                if (currentMode === 'pomodoro') {
                    brownNoise.volume = 0.3;
                    brownNoise.play().catch(e => console.log('Brown noise failed to play:', e));
                }
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        timerComplete();
                    }
                }, 1000);
            }
        };

        const pauseTimer = () => {
            if (isRunning) {
                isRunning = false;
                clearInterval(timerInterval);
                startBtn.classList.remove('hidden');
                pauseBtn.classList.add('hidden');
                brownNoise.pause();
            }
        };

        const resetTimer = () => {
            isRunning = false;
            clearInterval(timerInterval);
            timeLeft = timerDurations[currentMode];
            updateTimerDisplay();
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            brownNoise.pause();
            brownNoise.currentTime = 0;
        };

        const switchMode = (mode) => {
            currentMode = mode;
            resetTimer();
            
            // Update button styles
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('bg-opacity-80');
                btn.classList.add('bg-opacity-60');
            });
            
            if (mode === 'pomodoro') {
                pomodoroBtn.classList.remove('bg-opacity-60');
                pomodoroBtn.classList.add('bg-opacity-80');
            } else if (mode === 'shortBreak') {
                shortBreakBtn.classList.remove('bg-opacity-60');
                shortBreakBtn.classList.add('bg-opacity-80');
            } else if (mode === 'longBreak') {
                longBreakBtn.classList.remove('bg-opacity-60');
                longBreakBtn.classList.add('bg-opacity-80');
            }
        };

        const timerComplete = () => {
            isRunning = false;
            clearInterval(timerInterval);
            brownNoise.pause();
            brownNoise.currentTime = 0;
            
            // Play chime
            chimeSound.volume = 0.5;
            chimeSound.play().catch(e => console.log('Chime failed to play:', e));
            
            // Auto-switch modes
            if (currentMode === 'pomodoro') {
                pomodoroCount++;
                sessionCount.textContent = `Session ${pomodoroCount}`;
                
                // Every 4 pomodoros, take a long break
                if (pomodoroCount % 4 === 1) {
                    switchMode('longBreak');
                } else {
                    switchMode('shortBreak');
                }
            } else {
                switchMode('pomodoro');
            }
            
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
        };

        // --- To-Do List Logic ---
        const renderTasks = () => {
            taskList.innerHTML = '';
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between bg-white bg-opacity-10 rounded-lg p-2 text-sm';
                li.innerHTML = `
                    <div class="flex items-center flex-1">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="toggleTaskComplete(${index})"
                               class="mr-2 rounded text-xs">
                        <span class="${task.completed ? 'line-through text-gray-400' : 'text-white'} flex-1">
                            ${task.text}
                        </span>
                    </div>
                    <button onclick="deleteTask(${index})" 
                            class="text-red-400 hover:text-red-300 ml-2 text-xs">
                        ✕
                    </button>
                `;
                taskList.appendChild(li);
            });
        };

        const addTask = () => {
            const taskText = taskInput.value.trim();
            if (taskText) {
                tasks.push({ text: taskText, completed: false });
                localStorage.setItem('pomodoroTasks', JSON.stringify(tasks));
                taskInput.value = '';
                renderTasks();
            }
        };

        const toggleTaskComplete = (index) => {
            tasks[index].completed = !tasks[index].completed;
            localStorage.setItem('pomodoroTasks', JSON.stringify(tasks));
            renderTasks();
        };

        const deleteTask = (index) => {
            tasks.splice(index, 1);
            localStorage.setItem('pomodoroTasks', JSON.stringify(tasks));
            renderTasks();
        };

        // --- Application Logic ---

        const getDayOfYear = () => {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        };

        const getTodayDateString = () => {
            const today = new Date();
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        };

        /**
         * Sets a daily rotating background image from a predefined list.
         */
        const setDailyBackground = () => {
            const dayOfYear = getDayOfYear();
            const imageUrl = backgroundImages[dayOfYear % backgroundImages.length];
            
            const img = new Image();
            img.src = imageUrl;
            img.onload = () => {
                body.style.backgroundImage = `url('${imageUrl}')`;
                mainContent.classList.remove('opacity-0');
                footerContent.classList.remove('opacity-0');
            };
            img.onerror = () => {
                 body.style.backgroundImage = `url('https://placehold.co/1920x1080/000000/FFFFFF?text=Image+Failed+to+Load')`;
                 mainContent.classList.remove('opacity-0');
                 footerContent.classList.remove('opacity-0');
            }
        };

        /**
         * Displays a daily Quranic quote.
         */
        const displayDailyQuote = () => {
            const dayOfYear = getDayOfYear();
            const quote = quranicVerses[dayOfYear % quranicVerses.length];

            quranArabic.textContent = quote.arabic;
            quranEnglish.textContent = `"${quote.english}"`;
            quranReference.textContent = quote.reference;

            quranArabic.classList.add('fade-in');
            quranEnglish.classList.add('fade-in');
            quranReference.classList.add('fade-in');
        };

        /**
         * Updates the time and date display.
         */
        const updateDateTime = () => {
            const update = () => {
                const now = new Date();
                gregorianTime.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                gregorianDate.textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            };
            update();
            setInterval(update, 1000);
        };
        
        /**
         * Fetches and displays prayer times from the Aladhan API.
         */
        const fetchPrayerTimes = async (latitude, longitude) => {
            const todayDate = getTodayDateString();
            const cachedData = JSON.parse(localStorage.getItem('cachedPrayerTimes'));

            if (cachedData && cachedData.date === todayDate && cachedData.lat === latitude && cachedData.lon === longitude) {
                displayPrayerTimes(cachedData.timings, cachedData.hijri);
                return;
            }

            try {
                const response = await fetch(`https://api.aladhan.com/v1/timings/${todayDate.split('-').reverse().join('-')}?latitude=${latitude}&longitude=${longitude}&method=2`);
                if (!response.ok) throw new Error('Failed to fetch prayer times.');
                
                const data = await response.json();
                if (data.code !== 200) throw new Error(data.data || 'Invalid prayer time API response');
                
                const timings = data.data.timings;
                const hijriInfo = data.data.date.hijri;

                localStorage.setItem('cachedPrayerTimes', JSON.stringify({
                    date: todayDate,
                    lat: latitude,
                    lon: longitude,
                    timings: timings,
                    hijri: hijriInfo
                }));

                displayPrayerTimes(timings, hijriInfo);
            } catch (error) {
                console.error("Error fetching prayer times:", error);
                prayerTimesContainer.innerHTML = `<p class="col-span-full text-center text-red-400">Could not load prayer times. Please check coordinates and connection.</p>`;
            }
        };

        /**
         * Renders the prayer times and Islamic date on the page.
         */
        const displayPrayerTimes = (timings, hijriInfo) => {
            islamicDate.textContent = `${hijriInfo.weekday.en}, ${hijriInfo.day} ${hijriInfo.month.en}, ${hijriInfo.year}`;

            const prayers = { Fajr: timings.Fajr, Dhuhr: timings.Dhuhr, Asr: timings.Asr, Maghrib: timings.Maghrib, Isha: timings.Isha };

            // Helper function to convert 24-hour time to 12-hour AM/PM format
            const convertTo12Hour = (time24) => {
                const [hours, minutes] = time24.split(':');
                const hour = parseInt(hours);
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const hour12 = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                return `${hour12}:${minutes} ${ampm}`;
            };

            prayerTimesContainer.innerHTML = '';
            for (const [prayer, time] of Object.entries(prayers)) {
                const prayerEl = document.createElement('div');
                prayerEl.className = 'text-center p-3 rounded-md fade-in';
                prayerEl.innerHTML = `
                    <p class="font-semibold text-lg">${prayer}</p>
                    <p class="text-xl">${convertTo12Hour(time)}</p>
                `;
                prayerTimesContainer.appendChild(prayerEl);
            }
        };

        /**
         * Initializes the application.
         */
        const init = () => {
            setDailyBackground();
            displayDailyQuote();
            updateDateTime();
            
            // Initialize Pomodoro Timer
            updateTimerDisplay();
            sessionCount.textContent = `Session ${pomodoroCount}`;
            renderTasks();

            const savedLocation = localStorage.getItem('userLocation');

            if (savedLocation) {
                const { latitude, longitude } = JSON.parse(savedLocation);
                fetchPrayerTimes(latitude, longitude);
            } else {
                locationModal.classList.remove('hidden');
            }

            saveLocationBtn.addEventListener('click', () => {
                const latitude = parseFloat(latitudeInput.value);
                const longitude = parseFloat(longitudeInput.value);

                if (isNaN(latitude) || isNaN(longitude)) {
                    locationError.textContent = "Please enter valid numbers for latitude and longitude.";
                    return;
                }
                
                locationError.textContent = "";
                localStorage.setItem('userLocation', JSON.stringify({ latitude, longitude }));
                locationModal.classList.add('hidden');
                fetchPrayerTimes(latitude, longitude);
            });
            
            // Pomodoro Event Listeners
            pomodoroBtn.addEventListener('click', () => switchMode('pomodoro'));
            shortBreakBtn.addEventListener('click', () => switchMode('shortBreak'));
            longBreakBtn.addEventListener('click', () => switchMode('longBreak'));
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            resetBtn.addEventListener('click', resetTimer);
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
        };

        // --- Start the application on window load ---
        window.onload = init;

    </script>
</body>
</html>
